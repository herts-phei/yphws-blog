---
title: "Do LGBTQ+ YP have different aspirations for their future?"
date: '2023-06-16'
categories: ['lgbtq+', 'aspirations', 'school leavers']
format: html
editor: visual
---

```{r include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(dplyr)
library(purrr)
library(tidyverse)
library(knitr)
library(simplermarkdown)
library(here)

box::use(../../../phei_functions/hes)

source(here("R", "table.R"))
source(here("R", "functions.R"))

```

```{r}
yphws_data_private <- readRDS("~/projects/yphws_analysis/data/private/yphws_data_private.Rds")

# yphws_data_private <- yphws_data_private %>% filter(sexuality %in% c("Gay, lesbian or bisexual", "Heterosexual/Straight"))

count <- yphws_data_private$sexuality %>% table() %>% as_tibble() %>% rename("answer" = ".", "number" = "n")

count <- suppress_everything(count)

total_students <- nrow(yphws_data_private)

count <- count %>% mutate("%" = round((number/total_students)*100, 1))
```

#### Abstract

Young LGBTQ+ students face different lived experiences than those from non-care homes. This could influence their decision-making around aspirations after leaving school, such as their career, education, or training. This brief analysis seeks to ascertain whether a student's sexual orientation has a relationship with their aspirations after school.

```{r}
#| output: asis
print(kable(count))
```

: Summary count of students on question asking about sexual orientation in YPHWS {#tbl-summary-count}

The above table displays the proportion of responses around sexual orientation in YPHWS. *Heterosexual/straight* students make up just over 3/4 of the total responses, followed by *gay, lesbian, or bisexual* at just under 10%. Smaller proportions ticked options *other*, *undecided/questioning*, and *prefer not to say*.

## Methods

One of the questions coded in the YPHWS survey is ***what do you plan to do as a next step after leaving school?*** This is a multi-factorial answer, where students can respond either *yes, no, or maybe* to several options:

-   Education

-   Job

-   Training

-   Family

-   Uncertain

-   Other

We performed a chi-squared test for each of the different prospects questions on the tables below for each of the responses, along with their relative proportions. Note, these numbers have been suppressed to the nearest 5 to prevent disclosure, but the actual chi-squared tests have been performed on the raw numbers.

<details>

<br>

<summary>More on chi-squared tests</summary>

We can put the results of students answering the question in YPHWS in a contingency table, which tallies the responses into a table like:

| Care-experienced | Maybe | No  | Yes |
|------------------|-------|-----|-----|
| Yes              |       |     |     |
| Maybe            |       |     |     |
| No               |       |     |     |

With contingency tables, we can perform chi-square tests, which examines whether the categories of the rows and columns of a contingency table are statistically significantly associated.

The chi-squared test compares the observed frequencies from the data with expected frequencies if there were null or no relationship between the variables.

With chi-squared tests, we need sufficient size in each of the cells inside the table. While the number of students not care-experienced outnumber the number of students who answered prefer not to sayÂ or yes, there are still sufficient numbers to perform the test (\>5) in each of the responses.

After the critical chi-squared test value is calculated, we then use the degrees of freedom to match the results on a distribution table with a significance threshold to determine statistical significance, usually set at 0.05. More about chi-squared tests can be found at: ...

</details>

```{r}
tables <- chi_sq_tables("sexuality")

tables_df <- tables %>% map(as.data.frame.matrix)

tables_df_suppressed <- tables_df %>% map(~ .x %>% suppress_everything())

tables_df_suppressed_proportions <- tables_df_suppressed %>% map(~ .x %>% as.matrix %>% prop.table(margin = 1) %>% `*`(100) %>% round(1) %>% as.data.frame() %>% rownames_to_column("sexuality") %>% mutate(across(!"sexuality", ~ paste0(.x, "%"))))

tables_df_suppressed <- tables_df_suppressed %>% map(~ .x %>% as.data.frame() %>% rownames_to_column("sexuality"))

tables %>% map(chisq.test) -> chisq_results
```

## Results

::: {#tbl-panel-1 layout-ncol="3"}
```{r}
#| output: asis
print(kable(tables_df_suppressed[["education"]]))
```

: Numbers (suppressed) {#tbl-first}

```{r}
#| output: asis
print(kable(tables_df_suppressed_proportions[["education"]]))
```

: Percentages {#tbl-second}

```{r}
#| output: asis
print(kable(p_value_table("education")))
```

: Results {#tbl-third}

Plan to continue in education after leaving school

:::

::: {#tbl-panel-2 layout-ncol="3"}
```{r}
#| output: asis
print(kable(tables_df_suppressed[["job"]]))
```

: Numbers (suppressed) {#tbl-first}

```{r}
#| output: asis
print(kable(tables_df_suppressed_proportions[["job"]]))
```

: Percentages {#tbl-second}

```{r}
#| output: asis
print(kable(p_value_table("job")))
```

: Results {#tbl-third}

Plan to get a job after leaving school
:::

::: {#tbl-panel-3 layout-ncol="3"}
```{r}
#| output: asis
print(kable(tables_df_suppressed[["training"]]))
```

: Numbers (suppressed) {#tbl-first}

```{r}
#| output: asis
print(kable(tables_df_suppressed_proportions[["training"]]))
```

: Percentages {#tbl-second}

```{r}
#| output: asis
print(kable(p_value_table("training")))
```

: Results {#tbl-third}

Plan to train for a skilled job after leaving school
:::

::: {#tbl-panel-4 layout-ncol="3"}
```{r}
#| output: asis
print(kable(tables_df_suppressed[["family"]]))
```

: Numbers (suppressed) {#tbl-first}

```{r}
#| output: asis
print(kable(tables_df_suppressed_proportions[["family"]]))
```

: Percentages {#tbl-second}

```{r}
#| output: asis
print(kable(p_value_table("family")))
```

: Results {#tbl-third}

Plan to start a family after leaving school
:::

::: {#tbl-panel-5 layout-ncol="3"}
```{r}
#| output: asis
print(kable(tables_df_suppressed[["unsure"]]))
```

: Numbers (suppressed) {#tbl-first}

```{r}
#| output: asis
print(kable(tables_df_suppressed_proportions[["unsure"]]))
```

: Percentages {#tbl-second}

```{r}
#| output: asis
print(kable(p_value_table("unsure")))
```

: Results {#tbl-third}

Aren't sure what they want to do after leaving school
:::

::: {#tbl-panel-6 layout-ncol="3"}
```{r}
#| output: asis
print(kable(tables_df_suppressed[["other"]]))
```

: Numbers (suppressed) {#tbl-first}

```{r}
#| output: asis
print(kable(tables_df_suppressed_proportions[["other"]]))
```

: Percentages {#tbl-second}

```{r}
#| output: asis
print(kable(p_value_table("other")))
```

: Results {#tbl-third}

Have other plans after leaving school
:::

Here, we identify that the a student's LGBTQ+ label has a very statistically significant effect with ...

<details>

<summary>More on the results</summary>

<br> Below shows the chi-square tests applied to the contingency tables collated together:

```{r}
#| output: asis

chisq_results %>% imap( ~ tibble(
  question = .y,
  "x^2" = round(.x$statistic, 2),
  p.value = round(.x$p.value, 2)
)) %>% bind_rows() %>% kable()
```

A p.value of less than 0.05 indicates statistical significance, and that there is a relationship between the student's LGBTQ+ label and the specific prospect response.

A chi-squared test is a simple nonparametric test which only tells us of an association if statistical significance is found. Further analyses can be performed to elucidate further details on *how* or *why* the relationship between a children being looked after affects their prospective choices after education, but these are beyond the scope of this report.

</details>
