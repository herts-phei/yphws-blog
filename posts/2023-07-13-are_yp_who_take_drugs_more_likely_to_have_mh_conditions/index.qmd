---
title: 'Are young people who take drugs more likely to have mental health conditions?'
date: "`r Sys.Date()`"
categories: ['drugs', 'mental health']
description: 'This analysis explores the link between drug use in young people and association with mental health conditions.'
execute: 
  message: false
  warning: false
editor_options: 
  chunk_output_type: console
---

```{r include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
options(scipen = 999)

box::use(../../../../../phei_functions/hes)


library(tidyverse)
library(dplyr)
library(purrr)
library(tidyr)
library(stringr)
library(epitools)
library(knitr)
```

![](mental_health_service.jpg){width="363"}

## **Abstract**

There are established links between the effect taking drugs has on a population's mental health. With increasing numbers of young people seeking mental health support, this blog looks at how the impact of drugs may exacerbate the issue.

<!-- ## **Descriptive Analysis** -->

```{r}
yphws_data_private <- readRDS("~/projects/yphws_analysis/data/yphws_data_private.Rds")


data <- yphws_data_private %>% 
    dplyr::mutate(drug_yes_no = as.factor(ifelse(drug_ever == "I have never taken drugs",
                              "No",
                              "Yes")),
                mental_accessed = ifelse(mental_accessed == "Yes", "Yes", "No")
       #  mental_accessed = as.factor(mental_accessed)
         )

count <- data$drug_ever %>% table() %>% as_tibble() %>% rename("Answer" = ".")
count$n <- round(count$n/5)*5

count_binary_drugs <- data$drug_yes_no %>% table() %>% as_tibble() %>% rename("Answer" = ".")
count_binary_drugs$n <- round(count_binary_drugs$n/5)*5

count_binary_mental <- data$mental_accessed %>% table() %>% as_tibble() %>% rename("Answer" = ".")
count_binary_mental$n <- round(count_binary_mental$n/5)*5

drug_students <- round((count_binary_drugs %>% filter(Answer == "Yes") %>% pull(n))/5)*5
total_students <- round(nrow(data)/5)*5
drug_students_pct <- round((drug_students/total_students)*100, 2)

mental_students <- round((count_binary_mental %>% filter(Answer == "Yes") %>% pull(n))/5)*5
mental_students_pct <- round((mental_students/total_students)*100, 2)
```

To note, counts are rounded to the nearest 5 for disclosure purposes.

In the data collected for the latest YPHWS cohort, `r drug_students` students out of a total of `r total_students` students claimed to have taken a drug at least once, representing `r drug_students_pct`% of the total student population. `r count$n[count$Answer == "I take drugs regularly (once a week or more)"]` students claimed to take drugs regularly, representing `r  round((count$n[count$Answer == "I take drugs regularly (once a week or more)"]/total_students)*100, 2)`% of the student population.

The below table highlights the types of drugs taken by students. To note, individuals may have claimed to have taken more than one type of drug:

```{r}
cols <- grep("_exp|mental_accessed|age|condition_mental|sex|District|life_satisfied", names(data))

table <- data %>% 
  dplyr::select(cols) %>% 
  dplyr::select(-age, -sex, -mental_accessed, -sexuality, -condition_mental, -mental_accessed_helpful,
                -internet_message,
                -District, 
                -District_school) %>% 
  mutate_all(., ~ case_when(. == "Yes" ~ 1,
                            . == "No" ~ 0,
                            T ~ 0)) %>% 
  summarise_all(., ~ sum(.)) %>% 
  rename_all(., ~ gsub("\\_.*", "", .)) %>% 
  pivot_longer(cols = everything(), names_to = "Drug", values_to = "Number of Individuals saying they took drug") %>% 
  mutate(Drug = str_to_title(Drug),
         `Number of Individuals saying they took drug` = round(`Number of Individuals saying they took drug`/5)*5) #%>% 
  #flextable::flextable() %>% 
  #flextable::width(width = 8, unit = "cm")

kable(table)
```

Focusing on mental health, `r round(mental_students/5)*5` students claimed to have received a diagnosis through mental health support, representing `r mental_students_pct` % of the student population.

## **Methods**

To investigate links between drug use and issues related to mental health, logistic regression is used. This is a form of regression analysis where the response variable is binary (i.e. 0/1 or Yes/No). From the logistic regression, we can evaluate what predictors have an effect on the outcome of the response variable, whilst we can also compare between predictors using an odds ratio.

In the following, we treat accessing mental health as the response variable, meaning only individuals who claim they categorically did or did not access mental health services are included in the analysis.

In the following report we assess how drugs relate to:

-   Worrying about mental health;
-   Skipping school due to mental health;
-   Needing mental health services;
-   Having mental health conditions.

The analysis does not confirm causation. Predictors can only be linked to response variables (particularly if they are significant). It cannot be said for certain whether the predictor causes the response.

In some of the examples below, there are graphical representations of the logistic regression analysis and odds ratio outputs. In these graphs, there is a baseline group in which other groups are compared against (baselines are clarified in the examples), from which groups can be claimed to be more or less likely to have a certain characteristic (e.g. to have a mental health condition). Each group has an associated confidence interval, in which we can be 99% certain the real value lies in. Groups can be determined to be significantly different from one another if the intervals do not overlap, or the baseline group does not fall within the groups interval. 
<!-- <details> -->

<!-- <br> -->

<!-- <summary>More on logistic regression</summary> -->

## **Results**

### Is taking drugs linked to worrying about mental health?

```{r}
model_data <- data %>% 
  dplyr::select(age, District, sex, drug_ever, worry_mental, imd_quintile, schyear, life_satisfied,
                ethnicity) %>% 
  filter(!is.na(drug_ever), 
         !is.na(worry_mental)) %>% 
  dplyr::mutate(drug_yes_no = as.factor(ifelse(drug_ever == "I have never taken drugs",
                              "no",
                              "yes")),
                worry_mental = as.factor(ifelse(worry_mental == "Yes", "Yes", "No"))
         )

# 
# data_dd_odds <-
#   matrix(
#     c(
#       nrow(model_data[model_data$drug_yes_no == "no" &
#                         model_data$worry_mental == "No", ]),
#       nrow(model_data[model_data$drug_yes_no == "no" &
#                         model_data$worry_mental == "Yes", ]),
#       nrow(model_data[model_data$drug_yes_no == "yes" &
#                         model_data$worry_mental == "No", ]),
#       nrow(model_data[model_data$drug_yes_no == "yes" &
#                         model_data$worry_mental == "Yes", ])
#     ),
#     nrow = 2,
#     ncol = 2,
#     byrow = TRUE
#   )
# 
# 
# rownames(data_dd_odds) <- c('Drugs not taken', 'Drugs taken')
# colnames(data_dd_odds) <- c('Not worried about mental health', 'Worried about mental health')
# 
# 
# 
# ## p-value < 0.05. Can reject null hypothesis. The drugs taken and mental health accessed are dependent variables
# 
# ratio <- oddsratio(data_dd_odds)
# #data_dd_odds

model <- glm(data = model_data, worry_mental ~ drug_yes_no, family = binomial)

significance <- ifelse(summary(model)$coef[,4][2] <= 0.05, 
                      "This predictor is significant (p-value < 0.05).",
                      "This predictor is not significant.")

```

A total of `r round((nrow(model_data[model_data$drug_yes_no == 'yes', ]))/5)*5` students in this analysis took drugs, of which `r round((nrow(model_data[model_data$drug_yes_no == 'yes' & model_data$worry_mental == 'Yes', ]))/5)*5` students said they were worried about their mental health.

After conducting a logistic regression analysis, it was found that having taken drugs was a significant predictor in being worried about mental health, with students who took drugs being `r round(exp(coef(model))[2], 2)` times more likely to be worried about their mental health than students who did not take drugs. `r paste0(significance)`

### Is taking drugs linked to skipping school due to mental health?

```{r}
model_data <- data %>% 
  dplyr::select(age, District, sex, drug_ever, 
                skipschool_mentalhealth, imd_quintile, schyear,
                life_satisfied) %>% 
  filter(!is.na(drug_ever), 
         !is.na(skipschool_mentalhealth)) %>% 
  dplyr::mutate(drug_yes_no = as.factor(ifelse(drug_ever == "I have never taken drugs",
                              "no",
                              "yes")),
                skipschool_mentalhealth = as.factor(ifelse(skipschool_mentalhealth == "Yes",
                                                           "Yes", 
                                                           "No"))
         )


# data_dd_odds <-
#   matrix(
#     c(
#       nrow(model_data[model_data$drug_yes_no == "no" &
#                         model_data$skipschool_mentalhealth == "No", ]),
#       nrow(model_data[model_data$drug_yes_no == "no" &
#                         model_data$skipschool_mentalhealth == "Yes", ]),
#       nrow(model_data[model_data$drug_yes_no == "yes" &
#                         model_data$skipschool_mentalhealth == "No", ]),
#       nrow(model_data[model_data$drug_yes_no == "yes" &
#                         model_data$skipschool_mentalhealth == "Yes", ])
#     ),
#     nrow = 2,
#     ncol = 2,
#     byrow = TRUE
#   )
# 
# 
# rownames(data_dd_odds) <- c('Drugs not taken', 'Drugs taken')
# colnames(data_dd_odds) <- c('Dont skip school', 'Skip school')
# 
# 
# 
# ## p-value < 0.05. Can reject null hypothesis. The drugs taken and mental health accessed are dependent variables
# 
# ratio <- oddsratio(data_dd_odds)
# #data_dd_odds

model <- glm(data = model_data, skipschool_mentalhealth ~ drug_yes_no, family = binomial)

significance <- ifelse(summary(model)$coef[,4][2] <= 0.05, 
                      "This predictor is significant (p-value < 0.05).",
                      "This predictor is not significant.")

```

A total of `r round((nrow(model_data[model_data$drug_yes_no == 'yes', ]))/5)*5` students in this analysis took drugs, of which `r round((nrow(model_data[model_data$drug_yes_no == 'yes' & model_data$skipschool_mentalhealth == 'Yes', ]))/5)*5` students said they skip school due to their mental health.

After conducting a logistic regression analysis, it was found that having taken drugs was a significant predictor in skipping school, with students who took drugs being `r round(exp(coef(model))[2], 2)` times more likely to skip school due to mental health reasons than students who did not take drugs. `r paste0(significance)`

### Is taking drugs linked to accessing mental health services?

```{r}
model_data <- data %>%
  dplyr::select(age, District, sex, drug_ever, mental_accessed, imd_quintile, schyear, life_satisfied, ethnicity) %>%
  filter(!is.na(drug_ever),
         !is.na(mental_accessed),
         mental_accessed %in% c("Yes", "No")) %>%
  dplyr::mutate(drug_yes_no = as.factor(ifelse(drug_ever == "I have never taken drugs",
                              "no",
                              "yes")),
                mental_accessed = as.factor(ifelse(mental_accessed == "Yes",
                                                   "Yes",
                                                   "No"))
         )

# 
# data_dd_odds <-
#   matrix(
#     c(
#       nrow(model_data[model_data$drug_yes_no == "no" &
#                         model_data$mental_accessed == "No", ]),
#       nrow(model_data[model_data$drug_yes_no == "no" &
#                         model_data$mental_accessed == "Yes", ]),
#       nrow(model_data[model_data$drug_yes_no == "yes" &
#                         model_data$mental_accessed == "No", ]),
#       nrow(model_data[model_data$drug_yes_no == "yes" &
#                         model_data$mental_accessed == "Yes", ])
#     ),
#     nrow = 2,
#     ncol = 2,
#     byrow = TRUE
#   )
# 
# 
# rownames(data_dd_odds) <- c('Drugs not taken', 'Drugs taken')
# colnames(data_dd_odds) <- c('Not accessed mental health service', 'Accessed mental health services')
# 
# 
# 
# ## p-value < 0.05. Can reject null hypothesis. The drugs taken and mental health accessed are dependent variables
# 
# ratio <- oddsratio(data_dd_odds)
# #data_dd_odds
model <- glm(data = model_data, mental_accessed ~ drug_yes_no, family = binomial)

significance <- ifelse(summary(model)$coef[,4][2] <= 0.05, 
                      "This predictor is significant (p-value < 0.05).",
                      "This predictor is not significant.")

```

A total of `r round((nrow(model_data[model_data$drug_yes_no == 'yes', ]))/5)*5` students in this analysis took drugs, of which `r round((nrow(model_data[model_data$drug_yes_no == 'yes' & model_data$mental_accessed == 'Yes', ]))/5)*5` students accessed mental health services.

After conducting a logistic regression analysis, it was found that having taken drugs was a significant predictor in accessing mental health services, with students who took drugs being `r round(exp(coef(model))[2], 2)` times more likely to access mental health services than students who did not take drugs. `r paste0(significance)`

### Is taking drugs linked to mental health conditions?

```{r}
 model_data <- data %>% 
  dplyr::select(age, District, sex, drug_ever, condition_mental, imd_quintile, schyear, life_satisfied,
                mental_accessed) %>%
  filter(!is.na(drug_ever),
         !is.na(condition_mental)) %>%
  dplyr::mutate(drug_yes_no = as.factor(ifelse(drug_ever == "I have never taken drugs",
                              "no",
                              "yes")),
                condition_mental = as.factor(ifelse(condition_mental == "Yes",
                                                    "Yes",
                                                    "No")
                )
         )
# 
# 
# data_dd_odds <-
#   matrix(
#     c(
#       nrow(model_data[model_data$drug_yes_no == "no" &
#                         model_data$condition_mental == "No", ]),
#       nrow(model_data[model_data$drug_yes_no == "no" &
#                         model_data$condition_mental == "Yes", ]),
#       nrow(model_data[model_data$drug_yes_no == "yes" &
#                         model_data$condition_mental == "No", ]),
#       nrow(model_data[model_data$drug_yes_no == "yes" &
#                         model_data$condition_mental == "Yes", ])
#     ),
#     nrow = 2,
#     ncol = 2,
#     byrow = TRUE
#   )
# 
# 
# rownames(data_dd_odds) <- c('Drugs not taken', 'Drugs taken')
# colnames(data_dd_odds) <- c('No condition', 'Condition')
# 
# 
# 
# ## p-value < 0.05. Can reject null hypothesis. The drugs taken and mental health accessed are dependent variables
# 
# ratio <- oddsratio(data_dd_odds)
#data_dd_odds
model <- glm(data = model_data, condition_mental ~ drug_yes_no, family = binomial)

significance <- ifelse(summary(model)$coef[,4][2] <= 0.05, 
                      "This predictor is significant (p-value < 0.05).",
                      "This predictor is not significant.")

```

A total of `r round((nrow(model_data[model_data$drug_yes_no == 'yes', ]))/5)*5` students in this analysis took drugs, of which `r round((nrow(model_data[model_data$drug_yes_no == 'yes' & model_data$condition_mental == 'Yes', ]))/5)*5` students said they have a mental health condition.

After conducting a logistic regression analysis, it was found that having taken drugs was a significant predictor in having a mental health condition, with students who took drugs being `r round(exp(coef(model))[2], 2)` times more likely to have a mental health condition than students who did not take drugs. `r paste0(significance)`

### Does sex impact the likelihood of having a mental health condition?

```{r}

mental_condition_sex <- model_data %>% 
  filter(condition_mental %in% c("Yes", "No"),
         sex %in% c("Male", "Female")
      ) %>% 
  mutate(drug_yes_no = as.factor(ifelse(drug_yes_no == "yes", 
                                        "Drugs taken", 
                                        "Drugs not taken")),
         condition_mental = ifelse(condition_mental == "Yes", 1, 0),
         group = paste0(drug_yes_no, " - ", sex))

model <- glm(data = mental_condition_sex, condition_mental ~ group, family = binomial)

significance <- ifelse(summary(model)$coef[,4] <= 0.05, 
                      "This predictor is significant (p-value < 0.05).",
                      "This predictor is not significant.")


df <- as.data.frame(exp(coef(model))) %>% 
  rename(Coefficient =  "exp(coef(model))") %>% 
  mutate(Sex = rownames(.)) %>% 
  left_join(mutate(as.data.frame(exp(confint(model))), Sex = row.names(.))) %>% 
  mutate(Sex = gsub("group", "", Sex)) %>% 
  filter(Sex != "(Intercept)") %>% 
  rename(LCL = "2.5 %", UCL = "97.5 %")


ggplot(df, aes(x = Coefficient, y = Sex)) + 
    geom_vline(aes(xintercept = 1), size = .25, linetype = "dashed") +
    geom_errorbarh(aes(xmax = UCL, xmin = LCL), size = .5, height = 
                     .2, color = "gray50") +
    geom_point(size = 3.5, color = "blue") +
    theme_bw()+
    theme(panel.grid.minor = element_blank()) +
    ylab("Sex") +
    xlab("Odds ratio") +
    labs(title = "Mental health conditions having taken drugs by Sex",
         subtitle = "Drugs not taken (Female) - Baseline")
```

Compared to the baseline of females who have not taken drugs, females who have taken drugs are `r round(df$Coefficient[df$Sex== "Drugs taken - Female"], 2)` times more likely to have a mental health condition. Among those who have claimed to have taken drugs, females are `r round((df$Coefficient[df$Sex== "Drugs taken - Female"]/df$Coefficient[df$Sex== "Drugs taken - Male"]),2)` times more likely than males to have a mental health condition, a significant difference. Males who have taken drugs are `r round((df$Coefficient[df$Sex== "Drugs taken - Male"]/df$Coefficient[df$Sex== "Drugs not taken - Male"]),2)` times more likely to have a mental health condition than males who have not taken drugs.

### Does deprivation impact the likelihood of having a mental health condition?

```{r}

mental_condition_imd <- model_data %>% 
  filter(condition_mental %in% c("Yes", "No"),
         drug_yes_no == "yes",
         imd_quintile != "unknown") %>% 
  mutate(condition_mental = factor(condition_mental, levels = c("Yes", "No")))

model <- glm(data = mental_condition_imd, condition_mental ~ imd_quintile, family = binomial)

significance <- ifelse(summary(model)$coef[,4][2] <= 0.05, 
                      "This predictor is significant (p-value < 0.05).",
                      "This predictor is not significant.")

df <- as.data.frame(exp(coef(model))) %>% 
  rename(Coefficient =  "exp(coef(model))") %>% 
  mutate(IMD = rownames(.)) %>% 
  left_join(mutate(as.data.frame(exp(confint(model))), IMD = row.names(.))) %>% 
  mutate(IMD = gsub("imd_quintile", "", IMD)) %>% 
  filter(IMD != "(Intercept)") %>% 
  rename(LCL = "2.5 %", UCL = "97.5 %")

ggplot(df, aes(x = Coefficient, y = IMD)) + 
    geom_vline(aes(xintercept = 1), size = .25, linetype = "dashed") +
    geom_errorbarh(aes(xmax = UCL, xmin = LCL), size = .5, height = 
                     .2, color = "gray50") +
    geom_point(size = 3.5, color = "blue") +
    theme_bw()+
    theme(panel.grid.minor = element_blank()) +
    ylab("IMD") +
    xlab("Odds ratio") +
  labs(title = "Mental health conditions having taken drugs by IMD Quintile",
       subtitle = "IMD Quintile 1 Baseline")


```

For individuals who have claimed to have taken drugs, the likelihood of having a mental health condition is lowest for those residing in IMD Quintile 2 (most deprived). However, the differences between each Quintile are not significant.

### Does district of residence impact the likelihood of having a mental health condition?

```{r}

mental_condition_district <- model_data %>% 
  filter(condition_mental %in% c("Yes", "No"),
         drug_yes_no == "yes",
         District != "Prefer not to say / Unknown",
         District != "Outside of Hertfordshire") %>% 
  mutate(condition_mental = factor(condition_mental, levels = c("Yes", "No")),
         # District = factor(District, levels = c("Stevenage", "Broxbourne",
         #                                        "Dacorum", "East Hertfordshire",
         #                                        "Hertsmere",
         #                                        "North Hertfordshire", "St Albans",
         #                                        "Three Rivers", "Watford",
         #                                          "Welwyn Hatfield" ))
         )

model <- glm(data = mental_condition_district, condition_mental ~ District, family = binomial)

significance <- ifelse(summary(model)$coef[,4][2] <= 0.05, 
                      "This predictor is significant (p-value < 0.05).",
                      "This predictor is not significant.")

df <- as.data.frame(exp(coef(model))) %>% 
  rename(Coefficient =  "exp(coef(model))") %>% 
  mutate(District = rownames(.)) %>% 
  left_join(mutate(as.data.frame(exp(confint(model))), District = row.names(.))) %>% 
  mutate(District = gsub("District", "", District)) %>% 
  filter(District != "(Intercept)") %>% 
  rename(LCL = "2.5 %", UCL = "97.5 %")

ggplot(df, aes(x = Coefficient, y = District)) + 
    geom_vline(aes(xintercept = 1), size = .25, linetype = "dashed") +
    geom_errorbarh(aes(xmax = UCL, xmin = LCL), size = .5, height = 
                     .2, color = "gray50") +
    geom_point(size = 3.5, color = "blue") +
    theme_bw()+
    theme(panel.grid.minor = element_blank()) +
    ylab("District") +
    xlab("Odds ratio") +
  labs(title = "Mental health conditions having taken drugs by District",
       subtitle = "Broxbourne Baseline")


```

For individuals who have claimed to have taken drugs, the likelihood of having mental health condition is lowest for those residing in East Hertfordshire. However, the differences between each district are not significant.


## **Conclusions/implications**

In this report, we highlight that there is a significant link between drug use and the impact on an individual's mental health. Young people who take drugs are more likely to worry about their mental health, which is a cause for concern as drug use is often conducted in order to suppress mental health conditions, such as anxiety and depression. Young people who take drugs are also more likely to skip school do due mental health issues, which in turn will potentially affect their education in the short and long term. Students with zero absence are 10 times more likely to achieve the English Baccalaureate than those who miss 15%-20% of their school year. Despite these findings, it cannot be said for certain whether drug use **causes** issues that arise with mental health, it can only be claimed there is a link between the two variables.
